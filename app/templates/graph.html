<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de {{ localidad }} - EZGas</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">

    <!-- Agregar Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        #map {
            height: 650px;
            width: 100%;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #ddd;
        }

        .container {
            margin-top: 60px;
            margin-bottom: 60px;
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: #1e293b;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                margin-top: 20px;
                margin-bottom: 20px;
                padding-left: 10px;
                padding-right: 10px;
            }

            h1 {
                font-size: 1.5rem;
            }

            #map {
                height: 500px;
                border-radius: 12px;
                margin-top: 15px;
            }

            .btn-lg {
                width: 100%;
                font-size: 1rem;
                padding: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="text-center">Mapa Interactivo: {{ localidad }}</h1>
        <div id="map"></div>
        <div class="text-center mt-5">
            <a href="/" class="btn btn-outline-primary btn-lg px-5 d-inline-flex align-items-center gap-2"
                style="border-radius: 12px;">
                <i data-lucide="arrow-left"></i> Volver al Inicio
            </a>
        </div>
    </div>

    <script>
        // Inicializar Lucide
        lucide.createIcons();

        const estaciones = JSON.parse(`{{ estaciones | tojson | safe }}`);

        // Configuración de Mapa con Enfoque en España
        const map = L.map('map', {
            maxBounds: [[34, -13], [45, 7]],
            minZoom: 6,
            maxBoundsViscosity: 1.0
        }).setView([estaciones[0].latitud, estaciones[0].longitud], 13);

        // Agregar capa de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Capa de Máscara para resaltar España
        const worldCoords = [
            [90, -180], [90, 180], [-90, 180], [-90, -180], [90, -180]
        ];
        // Silueta con Margen (Espacio extra para evitar cortes accidentales)
        // Silueta con Margen Ajustado (Más ajustada pero con pequeño buffer)
        const spainSilhouette = [
            [44.2, -9.8], [44.2, -7.0], [43.9, -4.0], [43.7, -1.5], [43.0, 1.5],
            [42.8, 4.0], [42.0, 4.0], [41.0, 2.5], [39.5, 1.0], [38.0, 0.5],
            [36.8, -1.5], [36.2, -2.8], [36.2, -5.0], [35.6, -6.2], [36.4, -7.2],
            [36.4, -9.2], [38.0, -10.2], [41.0, -10.0], [42.5, -10.2], [44.2, -9.8]
        ];

        const mask = L.polygon([worldCoords, spainSilhouette], {
            color: 'rgba(59, 130, 246, 0.6)', // Azul neón transparente
            fillColor: '#000',
            fillOpacity: 0.72,
            weight: 5,
            dashArray: '8, 12', // Estilo técnico/profesional
            interactive: false
        }).addTo(map);

        // Agregar marcadores para cada estación
        estaciones.forEach(estacion => {
            L.marker([estacion.latitud, estacion.longitud])
                .addTo(map)
                .bindPopup(`<strong>Municipio:</strong> ${estacion.municipio}`);
        });
    </script>

    <!-- Agregar Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>